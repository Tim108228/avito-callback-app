import requests
import base64
import uuid
import time
from datetime import datetime

class AvitoGigaAssistant:
    def __init__(self):
        # –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ
        self.giga_client_id = "Gigachat api keys"
        self.giga_client_secret = "Gigachat api keys"
        
        self.avito_client_id = "h4nZK9fvBMgj9ysiNTDc"
        self.avito_client_secret = "Znz55kNJN81gbehVzFjJeU__YkyxPlks3en5ClbG"
        
        # URLs
        self.giga_auth_url = "https://ngw.devices.sberbank.ru:9443/api/v2/oauth"
        self.giga_api_url = "https://gigachat.devices.sberbank.ru/api/v1"
        self.avito_auth_url = "https://api.avito.ru/token"
        self.avito_api_url = "https://api.avito.ru"
        
        # –¢–æ–∫–µ–Ω—ã
        self.giga_token = None
        self.giga_token_expires = 0
        self.avito_token = None
        self.avito_token_expires = 0
        
        # –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–æ–≤
        self.conversations = {}
    
    # ==================== AVITO AUTH ====================
    
    def get_avito_token(self):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ access_token –¥–ª—è Avito API"""
        print(f"[{datetime.now()}] üîë –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω Avito...")
        
        credentials = f"{self.avito_client_id}:{self.avito_client_secret}"
        auth_key = base64.b64encode(credentials.encode()).decode()
        
        headers = {
            "Authorization": f"Basic {auth_key}",
            "Content-Type": "application/x-www-form-urlencoded"
        }
        
        data = {"grant_type": "client_credentials"}
        
        try:
            response = requests.post(
                self.avito_auth_url,
                headers=headers,
                data=data,
                timeout=10
            )
            
            print(f"   –°—Ç–∞—Ç—É—Å: {response.status_code}")
            
            if response.status_code == 200:
                token_data = response.json()
                self.avito_token = token_data["access_token"]
                self.avito_token_expires = time.time() + token_data["expires_in"] - 300
                
                print(f"   ‚úÖ –¢–æ–∫–µ–Ω Avito –ø–æ–ª—É—á–µ–Ω: {self.avito_token[:30]}...")
                print(f"   –î–µ–π—Å—Ç–≤—É–µ—Ç: {token_data['expires_in']} —Å–µ–∫—É–Ω–¥")
                return True
            else:
                print(f"   ‚ùå –û—à–∏–±–∫–∞: {response.status_code}")
                print(f"   –û—Ç–≤–µ—Ç: {response.text}")
                return False
                
        except Exception as e:
            print(f"   ‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {e}")
            return False
    
    def _refresh_avito_token_if_needed(self):
        if not self.avito_token or time.time() > self.avito_token_expires:
            return self.get_avito_token()
        return True
    
    # ==================== GIGACHAT AUTH ====================
    
    def get_gigachat_token(self):
        print(f"[{datetime.now()}] üîë –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω GigaChat...")
        
        credentials = f"{self.giga_client_id}:{self.giga_client_secret}"
        auth_key = base64.b64encode(credentials.encode()).decode()
        
        headers = {
            "Content-Type": "application/x-www-form-urlencoded",
            "Accept": "application/json",
            "RqUID": str(uuid.uuid4()),
            "Authorization": f"Basic {auth_key}"
        }
        data = {"scope": "GIGACHAT_API_PERS"}
        
        try:
            response = requests.post(self.giga_auth_url, headers=headers, data=data, verify=False)
            
            if response.status_code == 200:
                token_data = response.json()
                self.giga_token = token_data["access_token"]
                self.giga_token_expires = token_data["expires_at"] / 1000 - 300
                
                print(f"   ‚úÖ –¢–æ–∫–µ–Ω GigaChat –ø–æ–ª—É—á–µ–Ω")
                return True
            else:
                print(f"   ‚ùå –û—à–∏–±–∫–∞: {response.status_code} - {response.text}")
                return False
                
        except Exception as e:
            print(f"   ‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {e}")
            return False
    
    def _refresh_gigachat_token_if_needed(self):
        if not self.giga_token or time.time() > self.giga_token_expires:
            return self.get_gigachat_token()
        return True
    
    # ==================== –ü–†–ê–í–ò–õ–¨–ù–´–ï AVITO ENDPOINTS ====================
    
    def get_avito_chats(self):
        """–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —á–∞—Ç–æ–≤"""
        if not self._refresh_avito_token_if_needed():
            return []
        
        headers = {
            "Authorization": f"Bearer {self.avito_token}",
            "Content-Type": "application/json"
        }
        
        try:
            # –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π endpoint —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Avito
            response = requests.get(
                f"{self.avito_api_url}/messenger/v1/accounts/self/chats",
                headers=headers,
                timeout=10
            )
            
            print(f"[{datetime.now()}] üì® –ó–∞–ø—Ä–æ—Å —á–∞—Ç–æ–≤: {response.status_code}")
            
            if response.status_code == 200:
                data = response.json()
                return data.get("chats", [])
            elif response.status_code == 403:
                print(f"   ‚ö†Ô∏è  –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —á–∞—Ç–∞–º. –ù—É–∂–Ω—ã –ø—Ä–∞–≤–∞ 'messenger'")
                return []
            else:
                print(f"   ‚ùå –û—à–∏–±–∫–∞: {response.status_code} - {response.text[:200]}")
                return []
                
        except Exception as e:
            print(f"[{datetime.now()}] ‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {e}")
            return []
    
    def get_chat_messages(self, chat_id):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ —á–∞—Ç–∞"""
        if not self._refresh_avito_token_if_needed():
            return []
        
        headers = {
            "Authorization": f"Bearer {self.avito_token}",
            "Content-Type": "application/json"
        }
        
        try:
            response = requests.get(
                f"{self.avito_api_url}/messenger/v1/accounts/self/chats/{chat_id}/messages",
                headers=headers,
                timeout=10
            )
            
            if response.status_code == 200:
                return response.json().get("messages", [])
            else:
                print(f"[{datetime.now()}] ‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π: {response.status_code}")
                return []
                
        except Exception as e:
            print(f"[{datetime.now()}] ‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {e}")
            return []
    
    def send_avito_message(self, chat_id, message):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç Avito"""
        if not self._refresh_avito_token_if_needed():
            return False
        
        headers = {
            "Authorization": f"Bearer {self.avito_token}",
            "Content-Type": "application/json"
        }
        
        data = {
            "message": {
                "text": message
            }
        }
        
        try:
            response = requests.post(
                f"{self.avito_api_url}/messenger/v1/accounts/self/chats/{chat_id}/messages",
                headers=headers,
                json=data,
                timeout=10
            )
            
            if response.status_code == 200:
                print(f"[{datetime.now()}] ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ —á–∞—Ç {chat_id}")
                return True
            elif response.status_code == 403:
                print(f"[{datetime.now()}] ‚ö†Ô∏è  –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π")
                return False
            else:
                print(f"[{datetime.now()}] ‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: {response.status_code}")
                print(f"   –û—Ç–≤–µ—Ç: {response.text[:200]}")
                return False
                
        except Exception as e:
            print(f"[{datetime.now()}] ‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {e}")
            return False
    
    # ==================== –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ú–ï–¢–û–î–´ ====================
    
    def get_user_profile(self):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ—Ñ–∏–ª–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        if not self._refresh_avito_token_if_needed():
            return None
        
        headers = {
            "Authorization": f"Bearer {self.avito_token}",
            "Content-Type": "application/json"
        }
        
        try:
            response = requests.get(
                f"{self.avito_api_url}/core/v1/accounts/self",
                headers=headers,
                timeout=10
            )
            
            if response.status_code == 200:
                return response.json()
            else:
                print(f"[{datetime.now()}] ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è: {response.status_code}")
                return None
                
        except Exception as e:
            print(f"[{datetime.now()}] ‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {e}")
            return None
    
    def check_permissions(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø—Ä–∞–≤"""
        profile = self.get_user_profile()
        if profile:
            print(f"[{datetime.now()}] üë§ –ü—Ä–æ—Ñ–∏–ª—å: {profile.get('name', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')}")
            print(f"[{datetime.now()}] üîë –ü—Ä–∞–≤–∞: {profile.get('scopes', [])}")
            return profile.get('scopes', [])
        return []
    
    # ==================== GIGACHAT METHODS ====================
    
    def generate_response(self, user_message, context=None):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ GigaChat"""
        if not self._refresh_gigachat_token_if_needed():
            return "–ò–∑–≤–∏–Ω–∏—Ç–µ, —Å–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω."
        
        system_prompt = """–¢—ã - –ø–æ–º–æ—â–Ω–∏–∫ –ø—Ä–æ–¥–∞–≤—Ü–∞ –Ω–∞ Avito. –û—Ç–≤–µ—á–∞–π –≤–µ–∂–ª–∏–≤–æ –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ.
        
–ü—Ä–∞–≤–∏–ª–∞:
1. –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–π –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
2. –û—Ç–≤–µ—á–∞–π –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ —Ç–æ–≤–∞—Ä–µ
3. –£—Ç–æ—á–Ω—è–π –¥–µ—Ç–∞–ª–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
4. –ü—Ä–µ–¥–ª–∞–≥–∞–π —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –≤—Å—Ç—Ä–µ—á–∏
5. –ù–µ –¥–∞–≤–∞–π –∫–æ–Ω—Ç–∞–∫—Ç—ã –≤–Ω–µ Avito
6. –ö—Ä–∞—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É

–ü—Ä–∏–º–µ—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤:
- "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –î–∞, —Ç–æ–≤–∞—Ä –≤ –Ω–∞–ª–∏—á–∏–∏."
- "–ú–æ–∂–µ–º –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è —Å–µ–≥–æ–¥–Ω—è –ø–æ—Å–ª–µ 18:00."
- "–ö–∞–∫–æ–π —Ä–∞–∑–º–µ—Ä –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?"
- "–ò–∑–≤–∏–Ω–∏—Ç–µ, —Ü–µ–Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è.""""

        messages = [{"role": "system", "content": system_prompt}]
        
        if context:
            messages.extend(context[-4:])  # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 2 –ø–∞—Ä—ã –≤–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç
        
        messages.append({"role": "user", "content": user_message})
        
        headers = {
            "Authorization": f"Bearer {self.giga_token}",
            "Content-Type": "application/json"
        }
        
        data = {
            "model": "GigaChat",
            "messages": messages,
            "temperature": 0.7,
            "max_tokens": 120
        }
        
        try:
            response = requests.post(
                f"{self.giga_api_url}/chat/completions",
                headers=headers,
                json=data,
                verify=False,
                timeout=10
            )
            
            if response.status_code == 200:
                result = response.json()
                answer = result["choices"][0]["message"]["content"]
                return answer
            else:
                print(f"[{datetime.now()}] ‚ùå –û—à–∏–±–∫–∞ GigaChat: {response.status_code}")
                return "–ò–∑–≤–∏–Ω–∏—Ç–µ, –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–∞—à –∑–∞–ø—Ä–æ—Å."
                
        except Exception as e:
            print(f"[{datetime.now()}] ‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {e}")
            return "–ò–∑–≤–∏–Ω–∏—Ç–µ, —Å–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω."
    
    # ==================== MAIN LOGIC ====================
    
    def run_initial_test(self):
        """–ù–∞—á–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤"""
        print("=" * 60)
        print("üß™ –ù–ê–ß–ê–õ–¨–ù–´–ô –¢–ï–°–¢ –°–ò–°–¢–ï–ú–´")
        print("=" * 60)
        
        # 1. –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω—ã
        print("\n1. üîê –ü–û–õ–£–ß–ï–ù–ò–ï –¢–û–ö–ï–ù–û–í")
        if not self.get_avito_token():
            print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω Avito")
            return False
        
        if not self.get_gigachat_token():
            print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω GigaChat")
            return False
        
        # 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å –∏ –ø—Ä–∞–≤–∞
        print("\n2. üë§ –ü–†–û–í–ï–†–ö–ê –ü–†–û–§–ò–õ–Ø AVITO")
        scopes = self.check_permissions()
        
        if not scopes:
            print("‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–∞–≤–∞—Ö")
        elif "messenger" not in str(scopes):
            print("‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –ù–µ—Ç –ø—Ä–∞–≤ 'messenger' –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —á–∞—Ç–∞–º–∏!")
            print("   –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Avito")
        
        # 3. –¢–µ—Å—Ç GigaChat
        print("\n3. ü§ñ –¢–ï–°–¢ GIGACHAT")
        test_response = self.generate_response("–ü—Ä–∏–≤–µ—Ç! –¢—ã —Ä–∞–±–æ—Ç–∞–µ—à—å?")
        print(f"   –û—Ç–≤–µ—Ç: {test_response}")
        
        # 4. –¢–µ—Å—Ç —á–∞—Ç–æ–≤ Avito
        print("\n4. üí¨ –¢–ï–°–¢ –ß–ê–¢–û–í AVITO")
        chats = self.get_avito_chats()
        print(f"   –ù–∞–π–¥–µ–Ω–æ —á–∞—Ç–æ–≤: {len(chats)}")
        
        if chats:
            print(f"   –ü—Ä–∏–º–µ—Ä –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —á–∞—Ç–∞:")
            chat = chats[0]
            print(f"   - ID: {chat.get('id', 'N/A')}")
            print(f"   - –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: {chat.get('last_message', {}).get('text', 'N/A')[:50]}...")
        
        print("\n" + "=" * 60)
        print("‚úÖ –¢–ï–°–¢ –ó–ê–í–ï–†–®–ï–ù. –ó–∞–ø—É—Å–∫–∞—é –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥...")
        print("=" * 60)
        
        return True
    
    def run_polling(self, interval=30):
        """–û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –æ–ø—Ä–æ—Å–∞ —á–∞—Ç–æ–≤"""
        
        # –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç
        if not self.run_initial_test():
            print("‚ùå –¢–µ—Å—Ç –Ω–µ –ø—Ä–æ–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.")
            return
        
        processed_chats = set()
        
        print("\nüöÄ –ù–ê–ß–ò–ù–ê–Æ –ú–û–ù–ò–¢–û–†–ò–ù–ì –ß–ê–¢–û–í...")
        
        while True:
            try:
                # –ü–æ–ª—É—á–∞–µ–º —á–∞—Ç—ã
                chats = self.get_avito_chats()
                
                if not chats:
                    print(f"[{datetime.now()}] üì≠ –ß–∞—Ç–æ–≤ –Ω–µ—Ç")
                else:
                    print(f"[{datetime.now()}] üì® –ù–∞–π–¥–µ–Ω–æ —á–∞—Ç–æ–≤: {len(chats)}")
                    
                    for chat in chats:
                        chat_id = chat.get("id")
                        
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                        unread_count = chat.get("unread_count", 0)
                        if unread_count > 0 and chat_id not in processed_chats:
                            last_message = chat.get("last_message", {}).get("text", "")
                            
                            if last_message and len(last_message) > 2:  # –ù–µ –ø—É—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                                print(f"[{datetime.now()}] üí¨ –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ {chat_id[:8]}...")
                                print(f"   üë§: {last_message[:100]}...")
                                
                                # –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
                                messages = self.get_chat_messages(chat_id)
                                
                                # –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
                                context = []
                                for msg in messages[-6:]:  # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 –ø–∞—Ä—ã
                                    is_self = msg.get("author", {}).get("id") == "self"
                                    role = "assistant" if is_self else "user"
                                    context.append({"role": role, "content": msg.get("text", "")})
                                
                                # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
                                response = self.generate_response(last_message, context)
                                print(f"   ü§ñ: {response[:100]}...")
                                
                                # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç
                                if self.send_avito_message(chat_id, response):
                                    processed_chats.add(chat_id)
                                    print(f"[{datetime.now()}] ‚úÖ –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω")
                                else:
                                    print(f"[{datetime.now()}] ‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏")
                
                # –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏
                if len(processed_chats) > 50:
                    processed_chats = set(list(processed_chats)[-25:])
                
                # –ü–∞—É–∑–∞
                time.sleep(interval)
                
            except KeyboardInterrupt:
                print("\n\nüõë –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
                break
            except Exception as e:
                print(f"[{datetime.now()}] ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
                time.sleep(60)

# ==================== –ó–ê–ü–£–°–ö ====================

if __name__ == "__main__":
    bot = AvitoGigaAssistant()
    
    print("=" * 60)
    print("ü§ñ AVITO + GIGACHAT –ê–°–°–ò–°–¢–ï–ù–¢")
    print("=" * 60)
    
    # –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞
    print("\n–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã:")
    print("1. –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (—Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∞)")
    print("2. –ü–æ–ª–Ω—ã–π —Ä–µ–∂–∏–º (–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–∞—Ç–æ–≤)")
    
    choice = input("–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º (1/2): ").strip()
    
    if choice == "1":
        # –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç
        bot.run_initial_test()
        print("\nüìä –î–ª—è –ø–æ–ª–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω—É–∂–Ω–æ:")
        print("1. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∞ 'messenger' –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Avito")
        print("2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ 2")
    else:
        # –ü–æ–ª–Ω—ã–π —Ä–µ–∂–∏–º
        bot.run_polling(interval=20)